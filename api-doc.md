# API גישה מפתחים למערכת

ה-API מאפשרים כאן ואין מערכות נוספות למקרה המערכת שלך דרך אחד המייל אלא בצורה עצמאית. הדבר מעביר עבור מפתחים ומעוניינים המשתמשים בצורה אוטומטית עם המערכת.

בכל פעולה ב-API יש 2 חלקים:
1. חלק ראשון - שליחת בקשה לשרת
2. חלק שני - תשובה מהשרת

## כתובות השרת
לפעולות בשרת `ymt` ו-`yesbot` ו-`ymta` כתובת ה-URL ושליחת הבקשה היא:
```
https://www.call2all.co.il/ym/api/
```

לפעולות בשרת `ymta` ו-`ymtb` ניתן לשלוח בקשות גם לכתובת ה-URL:
```
https://private.call2all.co.il/ym/api/
```

## מבנה הבקשה
בדוגמאות להלן הכתובת הבסיסית תושמט ובמקומה יופיע `${url}`.

את כל הבקשות (למעט העלאת קבצים) ניתן לשלוח ב-POST או ב-GET. בבקשת POST ניתן לשלוח את הפרמטרים כ-JSON בתוך ה-body, כמובן יש לציין בפניה `Content-Type=application/json`.

הבקשה מורכבת מ-2 חלקים:
1. חלק א פקודה
2. חלק ב פרמטרים הדרושים

לדוגמה: הפקודה להורדת קובץ היא `DownloadFile` והפרמטרים הדרושים הם `path` ו-`token`.
במקרה כזה בקשת GET תראה כך:
```
https://www.call2all.co.il/ym/api/DownloadFile?token=677000000:1234&path=1v:2/1/1/000.wav
```

## מבנה התשובה
כל התשובות מהשרת (למעט הורדת קבצים) מוחזרות בפורמט JSON ונכללות את המידע שנדרש לבקשה. בהמשך נביא את כל התשובות הקיימות עבור כל בקשה.

### מבנה כללי
בנוסף, בכל תשובה יכללו המאפיינים הבאים:

- `yesmotAPIVersion` - גירסת ה-API הכוללת (עשוי לשמש לאיחור בעת תקיפות עם גרסאות עתידיות)
- `responseStatus` - מציין אודות הפעולה המבוקשת. אם הפעולה נכשלה, הערך יהיה `ERROR` עבור `FORBIDDEN`
- יופיעו שהבקשה הייתה אסורה על ידי השרת, עם `EXCEPTION` שיופיע שהבקשה נדחה לחריגה בשרת

### מאפיינים נוספים אפשריים בחלק מהבקשות
- `message` - הסבר על הפעולה שבוצעה או הסבר על השגיאה
- `messageCode` - קוד שגיאה, לתוכן יובאו כל סוגי הקודים והמקרים. אם נוספים קוד שגיאה שהתקבל מתוך `null` אז ישנה שגיאה כללית

דוגמה לתשובה הכוללת עם הודעת שגיאה:
```json
{
    "yesmotAPIVersion": "1",
    "responseStatus": "ERROR",
    "message": "Username or password is incorrect",
    "messageCode": 1
}
```

# התחברות למערכת

## הסבר
בכל הבקשות והפעולות לשרת יש צורך בפרמטר `token` שמשמש כקוד התחברות למערכת.
כאשר תשלחו פקודת Login תקבלו בחזרת פרמטר `token` שאת הערך שלו עליכם לצרף כשאתם שולחים גם מקודת API אחרת ודרך נוספת.

## פרטי הפונקציה
**שם הפונקציה**: `Login`

## פרמטרים נדרשים
| פרמטר | תיאור / הערות | סוג |
|-------|---------------|-----|
| username | מספר מערכת | string |
| password | סיסמת הגישה של המערכת | string |

## מאפייני תשובת השרת
| מאפיין | ערך | הערה |
|--------|-----|-------|
| token | טוקן | הטוקן שניתן יפוג לאחר 30 דקות אם לא תבצעו שיחת API עם הטוקן. כמו כן, כל עוד הטוקן חי יש להשתמש בו ולהימנע מבקשת התחברות נוספת |

## שימו לב
ישנה דרך נוספת ליצירת טוקן ללא צורך בבקשת `Login`.
כאשר שולחים כל פקודת API, לרשום בפרמטר `token` מספר מערכת : סיסמא (`username:password`)

## דוגמה
```
${url}+WebServiceName?token=${username}:${password}
```

# התנתקות מהמערכת

## הסבר
מחיקת הטוקן שהתקבל בהתחברות

## פרטי הפונקציה
**שם הפונקציה**: `Logout`

## פרמטרים נדרשים
| פרמטר | תיאור / הערות | סוג |
|-------|---------------|-----|
| token | טוקן | string |

## מאפייני תשובת השרת
אין מאפיינים מיוחדים בתשובת השרת
# קבלת תנועות יתרות מסמס

## פרטי הפונקציה
**שם הפונקציה**: `GetCustomerSmsTransactions`

## פרמטרים נדרשים
| פרמטר | תיאור | סוג |
|-------|--------|-----|
| token | טוקן | string |

## תיאור
מביא 2000 תנועות אחרונות

## תשובת השרת

### מבנה התשובה
| מאפיין | הסבר | סוג |
|---------|-------|-----|
| responseStatus | סטטוס הפעולה | string |
| yAfastVersion | גירסת מערכת | string |
| rows | מערך תנועות | array |

### פירוט איברי מערך התנועות
| שם | תיאור |
|-----|--------|
| transactionTime | זמן תנועה |
| amount | סכום תנועה ביחידות |
| description | תיאור חיווי |
| newBalance | יתרה עדכנית בביצוע הפעולה |
| expireDate | תאריך תפוגה של כל בול הפעולה |
| who | מבצע הפעולה |

### דוגמת תשובה
```json
{
    "responseStatus": "OK",
    "yAfastVersion": "גירסת מערכת",
    "rows": [
        {
            "transactionTime": "זמן תנועה",
            "amount": "סכום תנועה ביחידות",
            "description": "תיאור חיווי",
            "newBalance": "יתרה עדכנית בביצוע הפעולה",
            "expireDate": "תאריך תפוגה של כל בול הפעולה",
            "who": "מבצע הפעולה"
        }
    ]
}
```

# קבלת SMS שהתקבלו במערכת

## פרטי הפונקציה
**שם הפונקציה**: `GetSmsIncomingLog`

## בכל פניה יש צורך:

| פרמטר | תיאור | הערות |
|-------|--------|--------|
| token | טוקן | |
| limit | כמות ה SMS האחרונים להצגה | |
| startDate | מהתאריך | אופציונלי |
| endDate | עד התאריך | אופציונלי |

## מענה בעת הצלחה

| מאפיין | תיאור | סוג | דוגמה |
|---------|--------|-----|--------|
| responseStatus | סטטוס הפעולה | string | OK |
| rows | SMS שהתקבל + פרטים | array | מערך, יבואר מטה מבנה האובייקט |

## איבריקט במערך rows
כל הודעה נשלחת במערך נפרד, המורכב מפרמטרים כדלהלן:

| מאפיין | תיאור | סוג | דוגמה |
|---------|--------|-----|--------|
| dest | נשלח אל | int | 972501234567 |
| phone | הודעה מאת | int | 972541234567 |
| message | תוכן ההודעה | string | דרוש המרה לפורמט JSON |
| server_date | תאריך ושעת קבלת ההודעה | string | 2024-07-30 22:40:54 |

## דוגמא לקבלת ה SMS האחרון:
https://www.call2all.co.il/ym/api/GetSmsIncomingLog?token=xxxxx&limit=1
